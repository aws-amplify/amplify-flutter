name: Dart Package
description: Runs analyze, format, and test actions for Dart packages
inputs:
  working-directory:
    description: The working directory of the package
    required: true
  sdk:
    description: The Dart SDK version
    required: false
    default: stable
runs:
  using: composite
  steps:
    - name: Git Checkout
      uses: actions/checkout@v2

    - name: Setup Dart
      uses: dart-lang/setup-dart@v1
      with:
        sdk: ${{inputs.dart_sdk}}

    - name: Bootstrap
      shell: bash
      run: |
        dart pub global activate -spath packages/aft
        aft link

    - name: Get Packages
      shell: bash
      run: |
        dart pub get
      working-directory: ${{ inputs.working-directory }}
  
    - name: Check Formatting
      shell: bash
      run: dart format --set-exit-if-changed .
      working-directory: ${{inputs.working-directory}}

    - name: Analyze
      shell: bash
      run: dart analyze --fatal-infos --fatal-warnings .
      working-directory: ${{inputs.working-directory}}

    - name: Run Tests
      shell: bash
      run: |
        dart pub global activate coverage
        dart test -j ${{inputs.concurrency}} --coverage=coverage && dart pub global run coverage:format_coverage --lcov --in=coverage --out=coverage/lcov.info --packages=.dart_tool/package_config.json --report-on=${{inputs.report_on}}
      working-directory: ${{inputs.working-directory}}
