// Generated by worker_bee_builder.

import 'package:aws_common/aws_common.dart';
import 'package:aws_signature_v4/src/workers/hash_worker.dart';

/// The JS implementation of [HashWorker].
class HashWorkerImpl extends HashWorker {
  @override
  String get name => 'HashWorker';
  @override
  String get jsEntrypoint {
    // Flutter web release builds must use the bundled asset.
    if (zIsFlutter && !zDebugMode) {
      return 'assets/packages/aws_signature_v4/lib/src/workers/workers.min.js';
    }
    // Default to the compiled, published worker.
    return zDebugMode
        ? 'packages/aws_signature_v4/src/workers/workers.js'
        : 'packages/aws_signature_v4/src/workers/workers.min.js';
  }

  @override
  List<String> get fallbackUrls {
    // When running in a test, we need to find the `packages` directory which
    // is symlinked in the root `test/` directory.
    final baseUri = Uri.base;
    final basePath = baseUri.pathSegments
        .takeWhile((segment) => segment != 'test')
        .map(Uri.encodeComponent)
        .join('/');
    final testDir = Uri(
      scheme: baseUri.scheme,
      host: baseUri.host,
      port: baseUri.port,
      path: '$basePath/test',
    );
    const relativePath = zDebugMode
        ? 'packages/aws_signature_v4/src/workers/workers.debug.dart.js'
        : 'packages/aws_signature_v4/src/workers/workers.release.dart.js';
    return [
      relativePath,
      testDir.resolve(relativePath).toString(),
    ];
  }
}
